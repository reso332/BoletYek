<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Discond - Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¬ØªÙ…Ø¹ÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #5865F2;
            --primary-light: #7289DA;
            --secondary: #2F3136;
            --dark: #202225;
            --light: #F2F3F5;
            --text: #FFFFFF;
            --text-secondary: #B9BBBE;
            --success: #57F287;
            --error: #ED4245;
            --warning: #FEE75C;
            --google-blue: #4285F4;
            --google-red: #EA4335;
            --google-green: #34A853;
            --google-yellow: #FBBC05;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Tajawal', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: var(--text);
            overflow-x: hidden;
        }

        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .login-container {
            width: 100%;
            max-width: 480px;
            background: rgba(32, 34, 37, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideUp 0.6s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .login-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .login-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .google-login-btn {
            background: var(--google-blue);
            color: white;
            border: none;
            padding: 18px 24px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(66, 133, 244, 0.3);
        }

        .google-login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(66, 133, 244, 0.4);
            background: #3a7cf4;
        }

        .google-login-btn:active {
            transform: translateY(0);
        }

        .google-login-btn i {
            font-size: 1.4rem;
            background: white;
            color: var(--google-blue);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-footer {
            margin-top: 30px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
            height: 100vh;
            display: none;
        }

        .chat-layout {
            display: grid;
            grid-template-columns: 300px 1fr 280px;
            gap: 15px;
            height: calc(100vh - 30px);
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ø£ÙŠØ³Ø± */
        .left-sidebar {
            background: var(--secondary);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-profile {
            padding: 25px;
            background: var(--dark);
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary);
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .user-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .admin-badge {
            background: linear-gradient(45deg, var(--error), #ff6b6b);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .user-email {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .logout-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .logout-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù† */
        .admin-tools {
            padding: 20px;
            background: rgba(237, 66, 69, 0.1);
            border-radius: 12px;
            margin: 20px;
            border: 1px solid rgba(237, 66, 69, 0.2);
            display: none;
        }

        .admin-tools h3 {
            color: var(--error);
            margin-bottom: 20px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .admin-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .admin-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .admin-btn.success {
            background: var(--success);
        }

        .admin-btn.warning {
            background: var(--warning);
            color: #333;
        }

        .admin-btn.secondary {
            background: var(--primary);
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .chat-area {
            display: flex;
            flex-direction: column;
            background: var(--secondary);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .chat-header {
            padding: 20px;
            background: var(--dark);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h2 {
            font-size: 1.5rem;
            color: var(--text);
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
        }

        .online-dot {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
        }

        .message {
            display: flex;
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease;
            max-width: 100%;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.self {
            flex-direction: row-reverse;
        }

        .message.other {
            flex-direction: row;
        }

        .message-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 15px;
            flex-shrink: 0;
            border: 2px solid var(--primary);
        }

        .message-content {
            background: var(--dark);
            padding: 15px 20px;
            border-radius: 18px;
            max-width: 70%;
            position: relative;
            word-wrap: break-word;
            word-break: break-word;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .message.self .message-content {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-top-right-radius: 4px;
        }

        .message.other .message-content {
            background: var(--dark);
            border-top-left-radius: 4px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .message-name {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text);
        }

        .message.admin .message-name {
            color: var(--error);
        }

        .message-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .message-text {
            line-height: 1.6;
            font-size: 1rem;
        }

        .message.system {
            justify-content: center;
            max-width: 100%;
        }

        .message.system .message-content {
            background: rgba(87, 242, 135, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
            text-align: center;
            max-width: 80%;
        }

        .delete-btn {
            position: absolute;
            left: -25px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--error);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .message:hover .delete-btn {
            display: flex;
        }

        .delete-btn:hover {
            background: #ff5252;
            transform: translateY(-50%) scale(1.1);
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
        .input-area {
            padding: 20px;
            background: var(--dark);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .message-input-container {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        #message-input {
            flex: 1;
            background: var(--secondary);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 15px 20px;
            color: var(--text);
            font-size: 1rem;
            resize: none;
            min-height: 60px;
            max-height: 120px;
            transition: all 0.3s ease;
        }

        #message-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(88, 101, 242, 0.2);
        }

        #send-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0 25px;
            height: 60px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        #send-btn:hover:not(:disabled) {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        #send-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ø£ÙŠÙ…Ù† */
        .right-sidebar {
            background: var(--secondary);
            border-radius: 16px;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .online-users {
            margin-bottom: 30px;
        }

        .online-users h3 {
            color: var(--text);
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--dark);
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .user-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(-5px);
        }

        .user-item-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .user-item-info {
            flex: 1;
        }

        .user-item-name {
            font-weight: 600;
            color: var(--text);
            font-size: 0.95rem;
        }

        .user-item-status {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .status-indicators {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .status-value {
            color: var(--text);
            font-weight: 600;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± */
        .command-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            display: none;
        }

        .command-modal-content {
            background: var(--secondary);
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .command-modal-header {
            padding: 25px;
            background: var(--dark);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .command-modal-header h3 {
            color: var(--text);
            font-size: 1.3rem;
        }

        .command-users-list {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .command-user-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--dark);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .command-user-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(-5px);
        }

        .command-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .command-user-info {
            flex: 1;
        }

        .command-user-name {
            font-weight: 700;
            color: var(--text);
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .command-user-email {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .command-modal-footer {
            padding: 20px;
            background: var(--dark);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn.cancel {
            background: var(--text-secondary);
            color: var(--text);
        }

        .modal-btn.cancel:hover {
            background: #a0a0a0;
        }

        /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--secondary);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 3000;
            max-width: 350px;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            background: rgba(87, 242, 135, 0.2);
            color: var(--success);
        }

        .notification.error .notification-icon {
            background: rgba(237, 66, 69, 0.2);
            color: var(--error);
        }

        .notification.info .notification-icon {
            background: rgba(88, 101, 242, 0.2);
            color: var(--primary);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--text);
        }

        .notification-message {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Ù‚ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        .chat-locked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            padding: 20px;
            text-align: center;
        }

        .chat-locked-icon {
            font-size: 4rem;
            color: var(--error);
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .chat-locked-title {
            font-size: 2rem;
            color: var(--text);
            margin-bottom: 15px;
            font-weight: 700;
        }

        .chat-locked-message {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 500px;
            line-height: 1.6;
        }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© */
        @media (max-width: 1200px) {
            .chat-layout {
                grid-template-columns: 280px 1fr;
            }
            .right-sidebar {
                display: none;
            }
        }

        @media (max-width: 992px) {
            .chat-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                gap: 10px;
            }
            
            .left-sidebar {
                grid-row: 1;
                height: auto;
            }
            
            .user-profile {
                padding: 15px;
                display: flex;
                align-items: center;
                gap: 15px;
                text-align: left;
            }
            
            .user-avatar {
                width: 60px;
                height: 60px;
                margin-bottom: 0;
            }
            
            .user-info {
                flex: 1;
            }
            
            .admin-tools {
                margin: 15px;
                padding: 15px;
            }
            
            .admin-buttons {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .chat-area {
                grid-row: 2;
            }
        }

        @media (max-width: 768px) {
            .login-container {
                padding: 30px 20px;
            }
            
            .login-header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .message {
                margin-bottom: 15px;
            }
            
            .message-content {
                max-width: 85%;
                padding: 12px 16px;
            }
            
            .message-avatar {
                width: 40px;
                height: 40px;
                margin: 0 10px;
            }
            
            .input-area {
                padding: 15px;
            }
            
            #send-btn {
                padding: 0 20px;
                height: 55px;
            }
            
            #message-input {
                padding: 12px 16px;
                min-height: 55px;
            }
            
            .command-modal-content {
                margin: 10px;
            }
        }

        @media (max-width: 576px) {
            .login-screen {
                padding: 15px;
            }
            
            .login-container {
                padding: 25px 15px;
            }
            
            .google-login-btn {
                padding: 16px 20px;
                font-size: 1rem;
            }
            
            .chat-layout {
                gap: 8px;
            }
            
            .user-profile {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .user-info {
                text-align: center;
            }
            
            .admin-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .message {
                margin-bottom: 12px;
            }
            
            .message-content {
                max-width: 90%;
            }
            
            .message-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .message.self .message-header {
                align-items: flex-end;
            }
            
            .delete-btn {
                left: -20px;
                width: 20px;
                height: 20px;
                font-size: 12px;
            }
        }

        @media (max-width: 400px) {
            .login-header h1 {
                font-size: 1.8rem;
            }
            
            .google-login-btn {
                font-size: 0.95rem;
            }
            
            .chat-header h2 {
                font-size: 1.3rem;
            }
            
            .message-content {
                padding: 10px 14px;
            }
            
            .message-text {
                font-size: 0.95rem;
            }
            
            .admin-btn {
                padding: 10px 8px;
                font-size: 0.8rem;
            }
        }

        /* Ø¯Ø¹Ù… Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù„ÙˆØ­ÙŠØ© */
        @media (min-width: 768px) and (max-width: 1024px) {
            .chat-layout {
                grid-template-columns: 250px 1fr;
            }
            
            .message-content {
                max-width: 75%;
            }
            
            .user-avatar {
                width: 80px;
                height: 80px;
            }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        @media (min-width: 1400px) {
            .container {
                max-width: 1600px;
            }
            
            .chat-layout {
                grid-template-columns: 320px 1fr 320px;
                gap: 20px;
            }
        }

        /* Ø¯Ø¹Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ Ù„Ù„Ù‡ÙˆØ§ØªÙ */
        @media (max-height: 600px) and (orientation: landscape) {
            .login-screen {
                padding: 10px;
            }
            
            .login-container {
                padding: 20px;
                max-width: 90%;
            }
            
            .chat-layout {
                height: calc(100vh - 20px);
            }
            
            .messages-container {
                max-height: 60vh;
            }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ø§Ù…Ø© */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        .welcome-message {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 16px;
            margin: 20px;
            color: white;
        }

        .welcome-message h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .welcome-message p {
            opacity: 0.9;
            line-height: 1.6;
        }
    </style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginScreen" class="login-screen">
    <div class="login-container">
        <div class="login-header">
            <h1><i class="fas fa-comments"></i> Discond</h1>
            <p>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹Ù†Ø§ ÙˆØ§Ù†Ø·Ù„Ù‚ ÙÙŠ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø±Ø§Ø¦Ø¹Ø©</p>
        </div>
        
        <div class="login-options">
            <button id="googleLoginBtn" class="google-login-btn">
                <i class="fab fa-google"></i>
                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google
            </button>
        </div>
        
        <div class="login-footer">
            <p>Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŒ ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</p>
        </div>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± -->
<div id="commandModal" class="command-modal">
    <div class="command-modal-content">
        <div class="command-modal-header">
            <h3 id="commandModalTitle">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
        </div>
        <div class="command-users-list" id="commandUsersList">
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </div>
        <div class="command-modal-footer">
            <button id="commandCancelBtn" class="modal-btn cancel">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>
</div>

<!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
<div class="container" id="mainApp">
    <div class="chat-layout">
        
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ø£ÙŠØ³Ø± -->
        <div class="left-sidebar">
            <div class="user-profile">
                <img id="profileAvatar" class="user-avatar" src="https://ui-avatars.com/api/?name=Ù…Ø³ØªØ®Ø¯Ù…&background=5865F2&color=fff" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù">
                <div class="user-info">
                    <div class="user-name">
                        <span id="profileName">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                        <span id="adminBadge" class="admin-badge" style="display: none;">ğŸ‘‘ Ø¥Ø¯Ù…Ù†</span>
                    </div>
                    <div class="user-email" id="profileEmail">user@example.com</div>
                    <div class="user-id">ID: <span id="userIdText">---</span></div>
                </div>
                <button id="logoutBtn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                </button>
            </div>
            
            <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù† -->
            <div id="adminTools" class="admin-tools">
                <h3><i class="fas fa-shield-alt"></i> Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†</h3>
                
                <div class="admin-buttons">
                    <button id="lockBtn" class="admin-btn">
                        <i class="fas fa-lock"></i> Ù‚ÙÙ„
                    </button>
                    <button id="unlockBtn" class="admin-btn success">
                        <i class="fas fa-unlock"></i> ÙØªØ­
                    </button>
                    <button id="muteBtn" class="admin-btn warning">
                        <i class="fas fa-volume-mute"></i> ÙƒØªÙ…
                    </button>
                    <button id="unmuteBtn" class="admin-btn warning">
                        <i class="fas fa-volume-up"></i> Ø¥Ø²Ø§Ù„Ø© ÙƒØªÙ…
                    </button>
                    <button id="roleBtn" class="admin-btn secondary">
                        <i class="fas fa-crown"></i> ØªØ±Ù‚ÙŠØ©
                    </button>
                    <button id="unroleBtn" class="admin-btn secondary">
                        <i class="fas fa-user"></i> Ø¥Ø²Ø§Ù„Ø© ØªØ±Ù‚ÙŠØ©
                    </button>
                    <button id="clearChatBtn" class="admin-btn">
                        <i class="fas fa-trash"></i> Ù…Ø³Ø­
                    </button>
                    <button id="statsBtn" class="admin-btn secondary">
                        <i class="fas fa-chart-bar"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    </button>
                </div>
                
                <p style="font-size: 12px; color: var(--text-secondary); margin-top: 15px; text-align: center;">
                    Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø±
                </p>
            </div>
        </div>
        
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="chat-area">
            <!-- Ø­Ø§Ù„Ø© Ù‚ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
            <div id="chatLocked" class="chat-locked-overlay" style="display: none;">
                <div class="chat-locked-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h2 class="chat-locked-title">ğŸ”’ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…ØºÙ„Ù‚Ø©</h2>
                <p id="lockReason" class="chat-locked-message">
                    Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…ØºÙ„Ù‚Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ù…Ù†
                </p>
                <p id="lockTime" style="color: var(--text-secondary); margin-top: 15px; font-size: 0.9rem;"></p>
            </div>
            
            <div class="chat-header">
                <h2><i class="fas fa-comments"></i> Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
                <div class="chat-status">
                    <span class="online-dot"></span>
                    <span id="onlineStatus">Ù…ØªØµÙ„</span>
                    <span id="userCount">â€¢ 0 Ù…Ø³ØªØ®Ø¯Ù…</span>
                </div>
            </div>
            
            <div id="messagesContainer" class="messages-container">
                <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                <div class="welcome-message">
                    <h3>ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ Discond!</h3>
                    <p>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ØŒ Ù‡Ø°Ù‡ Ø¨Ø¯Ø§ÙŠØ© Ø±Ø§Ø¦Ø¹Ø© Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</p>
                </div>
            </div>
            
            <div class="input-area">
                <div class="message-input-container">
                    <textarea 
                        id="message-input" 
                        placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§... (Ø§Ø¶ØºØ· Enter Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ Shift+Enter Ù„Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯)"
                        rows="1"
                    ></textarea>
                    <button id="send-btn">
                        <i class="fas fa-paper-plane"></i>
                        Ø¥Ø±Ø³Ø§Ù„
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ø£ÙŠÙ…Ù† -->
        <div class="right-sidebar">
            <div class="online-users">
                <h3><i class="fas fa-users"></i> Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†</h3>
                <div id="onlineUsersList" class="user-list">
                    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡...
                    </div>
                </div>
            </div>
            
            <div class="status-indicators">
                <div class="status-item">
                    <span class="status-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:</span>
                    <span id="messageCount" class="status-value">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†:</span>
                    <span id="activeUsersCount" class="status-value">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…:</span>
                    <span id="serverStatus" class="status-value" style="color: var(--success);">âœ“ Ù†Ø´Ø·</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module">
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø§Øª Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { 
        getDatabase, 
        ref, 
        push, 
        set, 
        onChildAdded, 
        onValue, 
        remove, 
        serverTimestamp,
        get,
        update,
        query,
        orderByChild,
        equalTo
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";
    
    import { 
        getAuth, 
        GoogleAuthProvider, 
        signInWithPopup, 
        signOut,
        onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    // ØªÙƒÙˆÙŠÙ† Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyC8jmHxQ5tIwuh9J_Y9TpovequFVigiXYw",
        authDomain: "disconde-17f43.firebaseapp.com",
        databaseURL: "https://disconde-17f43-default-rtdb.firebaseio.com",
        projectId: "disconde-17f43",
        storageBucket: "disconde-17f43.firebasestorage.app",
        messagingSenderId: "1009347423340",
        appId: "1:1009347423340:web:a86dee5c542544ab223c49",
        measurementId: "G-8Q05LMTRDX"
    };

    // ØªÙ‡ÙŠØ¦Ø© Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // Ù…Ø±Ø§Ø¬Ø¹ Firebase
    const messagesRef = ref(db, 'messages');
    const usersRef = ref(db, 'users');
    const chatSettingsRef = ref(db, 'settings/chat');
    const mutedUsersRef = ref(db, 'mutedUsers');
    const onlineUsersRef = ref(db, 'onlineUsers');

    // Ø¹Ù†Ø§ØµØ± DOM
    const loginScreen = document.getElementById('loginScreen');
    const mainApp = document.getElementById('mainApp');
    const googleLoginBtn = document.getElementById('googleLoginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const profileName = document.getElementById('profileName');
    const profileEmail = document.getElementById('profileEmail');
    const profileAvatar = document.getElementById('profileAvatar');
    const userIdText = document.getElementById('userIdText');
    const adminBadge = document.getElementById('adminBadge');
    const adminTools = document.getElementById('adminTools');
    const messagesContainer = document.getElementById('messagesContainer');
    const messageInput = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');
    const onlineUsersList = document.getElementById('onlineUsersList');
    const messageCount = document.getElementById('messageCount');
    const userCount = document.getElementById('userCount');
    const activeUsersCount = document.getElementById('activeUsersCount');
    const onlineStatus = document.getElementById('onlineStatus');
    const chatLocked = document.getElementById('chatLocked');
    const lockReason = document.getElementById('lockReason');
    const lockTime = document.getElementById('lockTime');
    const serverStatus = document.getElementById('serverStatus');

    // Ø¹Ù†Ø§ØµØ± Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†
    const lockBtn = document.getElementById('lockBtn');
    const unlockBtn = document.getElementById('unlockBtn');
    const muteBtn = document.getElementById('muteBtn');
    const unmuteBtn = document.getElementById('unmuteBtn');
    const roleBtn = document.getElementById('roleBtn');
    const unroleBtn = document.getElementById('unroleBtn');
    const clearChatBtn = document.getElementById('clearChatBtn');
    const statsBtn = document.getElementById('statsBtn');

    // Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    const commandModal = document.getElementById('commandModal');
    const commandModalTitle = document.getElementById('commandModalTitle');
    const commandUsersList = document.getElementById('commandUsersList');
    const commandCancelBtn = document.getElementById('commandCancelBtn');

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
    let currentUser = {
        uid: '',
        name: '',
        email: '',
        photoURL: '',
        shortId: '',
        isAdmin: false
    };

    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    let chatLockedUntil = null;
    let mutedUsers = {};
    let onlineUsers = {};
    let currentCommand = '';
    let messageCounter = 0;
    let userCounter = 0;

    // ========== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†Ø¸Ø§Ù… ==========

    // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø±
    function showNotification(title, message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        
        const icon = type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'â„¹';
        const iconClass = type === 'success' ? 'fas fa-check-circle' : 
                         type === 'error' ? 'fas fa-exclamation-circle' : 
                         'fas fa-info-circle';
        
        notification.innerHTML = `
            <div class="notification-icon">
                <i class="${iconClass}"></i>
            </div>
            <div class="notification-content">
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
        setTimeout(() => {
            notification.style.animation = 'slideInRight 0.3s ease reverse';
            setTimeout(() => notification.remove(), 300);
        }, 5000);
    }

    // ØªÙˆÙ„ÙŠØ¯ ID Ù‚ØµÙŠØ±
    function generateShortId() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        for (let i = 0; i < 6; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¬ÙˆØ¬Ù„
    googleLoginBtn.addEventListener('click', async () => {
        try {
            googleLoginBtn.disabled = true;
            googleLoginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            
            const result = await signInWithPopup(auth, provider);
            
            showNotification('Ù†Ø¬Ø§Ø­', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
            
            let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            if (error.code === 'auth/popup-closed-by-user') {
                errorMessage = 'ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            } else if (error.code === 'auth/network-request-failed') {
                errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
            }
            
            showNotification('Ø®Ø·Ø£', errorMessage, 'error');
            
            googleLoginBtn.disabled = false;
            googleLoginBtn.innerHTML = '<i class="fab fa-google"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google';
        }
    });

    // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
    logoutBtn.addEventListener('click', async () => {
        try {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
            if (currentUser.uid) {
                await remove(ref(db, `onlineUsers/${currentUser.uid}`));
                await remove(ref(db, `users/${currentUser.uid}/online`));
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Firebase Auth
            await signOut(auth);
            
            showNotification('Ù†Ø¬Ø§Ø­', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error);
            showNotification('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
        }
    });

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            // ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            await handleUserLogin(user);
        } else {
            // ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            handleUserLogout();
        }
    });

    // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    async function handleUserLogin(firebaseUser) {
        try {
            // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            currentUser.uid = firebaseUser.uid;
            currentUser.name = firebaseUser.displayName || 'Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
            currentUser.email = firebaseUser.email;
            currentUser.photoURL = firebaseUser.photoURL || 
                `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.name)}&background=5865F2&color=fff`;
            currentUser.shortId = generateShortId();
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const userData = {
                uid: currentUser.uid,
                name: currentUser.name,
                email: currentUser.email,
                photoURL: currentUser.photoURL,
                shortId: currentUser.shortId,
                isAdmin: false,
                lastSeen: serverTimestamp(),
                joinedAt: serverTimestamp(),
                online: true
            };
            
            await set(ref(db, `users/${currentUser.uid}`), userData);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
            await set(ref(db, `onlineUsers/${currentUser.uid}`), {
                name: currentUser.name,
                photoURL: currentUser.photoURL,
                shortId: currentUser.shortId,
                joinedAt: serverTimestamp()
            });
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            updateUserUI();
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø§Ø´Ø§Øª
            loginScreen.style.display = 'none';
            mainApp.style.display = 'block';
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
            await sendWelcomeMessage();
            
            // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            startDataMonitoring();
            
            // ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„ÙƒØªØ§Ø¨Ø©
            setTimeout(() => messageInput.focus(), 500);
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
            showNotification('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    function handleUserLogout() {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        currentUser = {
            uid: '',
            name: '',
            email: '',
            photoURL: '',
            shortId: '',
            isAdmin: false
        };
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        loginScreen.style.display = 'flex';
        mainApp.style.display = 'none';
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        googleLoginBtn.disabled = false;
        googleLoginBtn.innerHTML = '<i class="fab fa-google"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google';
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function updateUserUI() {
        profileName.textContent = currentUser.name;
        profileEmail.textContent = currentUser.email;
        profileAvatar.src = currentUser.photoURL;
        userIdText.textContent = currentUser.shortId;
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
    async function sendWelcomeMessage() {
        try {
            await push(messagesRef, {
                type: 'system',
                userId: 'system',
                userName: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                userAvatar: 'https://cdn-icons-png.flaticon.com/512/1828/1828640.png',
                text: `ğŸ‰ Ø§Ù†Ø¶Ù… ${currentUser.name} Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©!`,
                timestamp: serverTimestamp()
            });
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨:', error);
        }
    }

    // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function startDataMonitoring() {
        monitorAdminStatus();
        monitorChatSettings();
        monitorMutedUsers();
        monitorOnlineUsers();
        monitorMessages();
        monitorUserCount();
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†
    function monitorAdminStatus() {
        const adminRef = ref(db, `users/${currentUser.uid}/isAdmin`);
        
        onValue(adminRef, (snapshot) => {
            if (snapshot.exists()) {
                currentUser.isAdmin = snapshot.val();
                
                if (currentUser.isAdmin) {
                    adminBadge.style.display = 'inline-block';
                    adminTools.style.display = 'block';
                } else {
                    adminBadge.style.display = 'none';
                    adminTools.style.display = 'none';
                }
            }
        });
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
    function monitorChatSettings() {
        onValue(chatSettingsRef, (snapshot) => {
            if (snapshot.exists()) {
                const settings = snapshot.val();
                
                if (settings.isLocked) {
                    chatLocked.style.display = 'flex';
                    messageInput.disabled = true;
                    sendBtn.disabled = true;
                    
                    lockReason.textContent = settings.lockReason || 'Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…ØºÙ„Ù‚Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ù…Ù†';
                    
                    if (settings.lockedUntil) {
                        const lockDate = new Date(settings.lockedUntil);
                        const now = new Date();
                        const diff = lockDate - now;
                        
                        if (diff > 0) {
                            const minutes = Math.ceil(diff / (1000 * 60));
                            lockTime.textContent = `Ø³ØªÙØªØ­ Ø¨Ø¹Ø¯ ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
                            chatLockedUntil = settings.lockedUntil;
                        } else {
                            // Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ù‚ÙÙ„
                            update(chatSettingsRef, {
                                isLocked: false,
                                lockedBy: null,
                                lockReason: null,
                                lockedUntil: null,
                                lockedAt: null
                            });
                        }
                    }
                } else {
                    chatLocked.style.display = 'none';
                    messageInput.disabled = false;
                    sendBtn.disabled = false;
                    chatLockedUntil = null;
                }
            }
        });
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙƒØªÙˆÙ…ÙŠÙ†
    function monitorMutedUsers() {
        onValue(mutedUsersRef, (snapshot) => {
            mutedUsers = snapshot.exists() ? snapshot.val() : {};
        });
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
    function monitorOnlineUsers() {
        onValue(onlineUsersRef, (snapshot) => {
            onlineUsers = snapshot.exists() ? snapshot.val() : {};
            updateOnlineUsersList();
        });
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
    function updateOnlineUsersList() {
        if (Object.keys(onlineUsers).length === 0) {
            onlineUsersList.innerHTML = '<div class="empty-state"><i class="fas fa-user-slash"></i><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…ØªØµÙ„ÙˆÙ†</p></div>';
            return;
        }
        
        let usersHTML = '';
        Object.entries(onlineUsers).forEach(([userId, user]) => {
            if (userId === currentUser.uid) return;
            
            usersHTML += `
                <div class="user-item">
                    <img src="${user.photoURL || 'https://ui-avatars.com/api/?name=Ù…Ø³ØªØ®Ø¯Ù…&background=5865F2&color=fff'}" 
                         class="user-item-avatar" 
                         alt="${user.name}"
                         onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=5865F2&color=fff'">
                    <div class="user-item-info">
                        <div class="user-item-name">${user.name}</div>
                        <div class="user-item-status">${user.shortId}</div>
                    </div>
                    <div class="online-dot"></div>
                </div>
            `;
        });
        
        onlineUsersList.innerHTML = usersHTML || '<div class="empty-state"><i class="fas fa-user"></i><p>Ø£Ù†Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙˆØ­ÙŠØ¯ Ø§Ù„Ù…ØªØµÙ„</p></div>';
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    function monitorMessages() {
        // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        const welcomeMessage = messagesContainer.querySelector('.welcome-message');
        if (welcomeMessage) {
            welcomeMessage.remove();
        }
        
        onChildAdded(messagesRef, (snapshot) => {
            const message = snapshot.val();
            displayMessage(message, snapshot.key);
        });
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    function displayMessage(message, messageId) {
        const messageDiv = document.createElement('div');
        
        // ØªØ­Ø¯ÙŠØ¯ ÙØ¦Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        let messageClass = 'message';
        if (message.userId === currentUser.uid) {
            messageClass += ' self';
        } else if (message.userId === 'system') {
            messageClass += ' system';
        } else {
            messageClass += ' other';
        }
        
        if (message.isAdmin) {
            messageClass += ' admin';
        }
        
        messageDiv.className = messageClass;
        messageDiv.dataset.messageId = messageId;
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
        const time = message.timestamp ? new Date(message.timestamp) : new Date();
        const timeString = time.toLocaleTimeString('ar-EG', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true 
        });
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        if (message.type === 'system') {
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-text">${message.text}</div>
                </div>
            `;
        } else {
            const displayName = `${message.userName || 'Ù…Ø³ØªØ®Ø¯Ù…'} (${message.shortId || '000000'})`;
            
            messageDiv.innerHTML = `
                <img src="${message.userAvatar || 'https://ui-avatars.com/api/?name=Ù…Ø³ØªØ®Ø¯Ù…&background=5865F2&color=fff'}" 
                     class="message-avatar" 
                     alt="${message.userName}"
                     onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(message.userName)}&background=5865F2&color=fff'">
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-name">${displayName} ${message.isAdmin ? 'ğŸ‘‘' : ''}</span>
                        <span class="message-time">${timeString}</span>
                    </div>
                    <div class="message-text">${message.text}</div>
                </div>
                ${currentUser.isAdmin && message.userId !== 'system' ? 
                    `<button class="delete-btn" onclick="deleteMessage('${messageId}')"><i class="fas fa-trash"></i></button>` : ''}
            `;
        }
        
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        messageCounter++;
        messageCount.textContent = messageCounter;
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    function monitorUserCount() {
        onValue(usersRef, (snapshot) => {
            if (snapshot.exists()) {
                const users = snapshot.val();
                userCounter = Object.keys(users).length;
                userCount.textContent = `â€¢ ${userCounter} Ù…Ø³ØªØ®Ø¯Ù…`;
                activeUsersCount.textContent = Object.keys(onlineUsers).length;
            }
        });
    }

    // ========== Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ==========

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    sendBtn.addEventListener('click', sendMessage);

    messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    // Ø¶Ø¨Ø· Ø§Ø±ØªÙØ§Ø¹ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    messageInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });

    async function sendMessage() {
        const text = messageInput.value.trim();
        
        if (!text) {
            showNotification('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø©', 'error');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒØªÙ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (mutedUsers[currentUser.uid]) {
            const muteInfo = mutedUsers[currentUser.uid];
            if (muteInfo.mutedUntil && new Date(muteInfo.mutedUntil) > new Date()) {
                showNotification('Ù…ÙƒØªÙˆÙ…', 'Ø£Ù†Øª Ù…ÙƒØªÙˆÙ… ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', 'error');
                return;
            }
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        if (chatLockedUntil && !currentUser.isAdmin) {
            showNotification('Ù…Ù‚ÙÙˆÙ„', 'Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…ØºÙ„Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹', 'error');
            return;
        }
        
        try {
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            await push(messagesRef, {
                userId: currentUser.uid,
                shortId: currentUser.shortId,
                userName: currentUser.name,
                userAvatar: currentUser.photoURL,
                text: text,
                timestamp: serverTimestamp(),
                isAdmin: currentUser.isAdmin
            });
            
            // Ù…Ø³Ø­ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
            commandModal.style.display = 'none';
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
            showNotification('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
        }
    }

    // ========== Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù† ==========

    // Ù‚ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
    lockBtn.addEventListener('click', () => {
        if (!currentUser.isAdmin) {
            showNotification('Ø±ÙØ¶', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†', 'error');
            return;
        }
        showCommandModal('lock', 'Ù‚ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©');
    });

    // ÙØªØ­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
    unlockBtn.addEventListener('click', async () => {
        if (!currentUser.isAdmin) {
            showNotification('Ø±ÙØ¶', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†', 'error');
            return;
        }
        
        try {
            await update(chatSettingsRef, {
                isLocked: false,
                lockedBy: null,
                lockReason: null,
                lockedUntil: null,
                lockedAt: null
            });
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†Ø¸Ø§Ù…
            await push(messagesRef, {
                type: 'system',
                userId: 'system',
                userName: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                userAvatar: 'https://cdn-icons-png.flaticon.com/512/1828/1828640.png',
                text: `ğŸ”“ Ù‚Ø§Ù… ${currentUser.name} Ø¨ÙØªØ­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©`,
                timestamp: serverTimestamp()
            });
            
            showNotification('Ù†Ø¬Ø§Ø­', 'ØªÙ… ÙØªØ­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©:', error);
            showNotification('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ÙØªØ­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©', 'error');
        }
    });

    // ÙƒØªÙ… Ù…Ø³ØªØ®Ø¯Ù…
    muteBtn.addEventListener('click', () => {
        if (!currentUser.isAdmin) {
            showNotification('Ø±ÙØ¶', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†', 'error');
            return;
        }
        showCommandModal('mute', 'ÙƒØªÙ… Ù…Ø³ØªØ®Ø¯Ù…');
    });

    // Ø¥Ø²Ø§Ù„Ø© ÙƒØªÙ…
    unmuteBtn.addEventListener('click', () => {
        if (!currentUser.isAdmin) {
            showNotification('Ø±ÙØ¶', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†', 'error');
            return;
        }
        showCommandModal('unmute', 'Ø¥Ø²Ø§Ù„Ø© ÙƒØªÙ… Ù…Ø³ØªØ®Ø¯Ù…');
    });

    // ØªØ±Ù‚ÙŠØ© Ù„Ø¥Ø¯Ù…Ù†
    roleBtn.addEventListener('click', () => {
        if (!currentUser.isAdmin) {
            showNotification('Ø±ÙØ¶', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†', 'error');
            return;
        }
        showCommandModal('role', 'ØªØ±Ù‚ÙŠØ© Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¥Ø¯Ù…Ù†');
    });

    // Ø¥Ø²Ø§Ù„Ø© ØªØ±Ù‚ÙŠØ©
    unroleBtn.addEventListener('click', () => {
        if (!currentUser.isAdmin) {
            showNotification('Ø±ÙØ¶', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†', 'error');
            return;
        }
        showCommandModal('unrole', 'Ø¥Ø²Ø§Ù„Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†');
    });

    // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
    clearChatBtn.addEventListener('click', async () => {
        if (!currentUser.isAdmin) {
            showNotification('Ø±ÙØ¶', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†', 'error');
            return;
        }
        
        if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
            try {
                await remove(messagesRef);
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†Ø¸Ø§Ù…
                await push(messagesRef, {
                    type: 'system',
                    userId: 'system',
                    userName: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                    userAvatar: 'https://cdn-icons-png.flaticon.com/512/1828/1828640.png',
                    text: `ğŸ—‘ï¸ Ù‚Ø§Ù… ${currentUser.name} Ø¨Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„`,
                    timestamp: serverTimestamp()
                });
                
                showNotification('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:', error);
                showNotification('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', 'error');
            }
        }
    });

    // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    statsBtn.addEventListener('click', async () => {
        if (!currentUser.isAdmin) {
            showNotification('Ø±ÙØ¶', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†', 'error');
            return;
        }
        
        try {
            const usersSnapshot = await get(usersRef);
            const messagesSnapshot = await get(messagesRef);
            const onlineSnapshot = await get(onlineUsersRef);
            
            const totalUsers = usersSnapshot.exists() ? Object.keys(usersSnapshot.val()).length : 0;
            const totalMessages = messagesSnapshot.exists() ? Object.keys(messagesSnapshot.val()).length : 0;
            const onlineCount = onlineSnapshot.exists() ? Object.keys(onlineSnapshot.val()).length : 0;
            
            const adminCount = usersSnapshot.exists() ? 
                Object.values(usersSnapshot.val()).filter(user => user.isAdmin).length : 0;
            
            alert(`
ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${totalUsers}
ğŸ’¬ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${totalMessages}
ğŸŸ¢ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†: ${onlineCount}
ğŸ‘‘ Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¯Ù…Ù†: ${adminCount}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            `);
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
            showNotification('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', 'error');
        }
    });

    // ========== Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± ==========

    // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    async function showCommandModal(command, title) {
        currentCommand = command;
        commandModalTitle.textContent = title;
        commandUsersList.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</div>';
        commandModal.style.display = 'flex';
        
        try {
            const usersSnapshot = await get(usersRef);
            
            if (!usersSnapshot.exists() || Object.keys(usersSnapshot.val()).length <= 1) {
                commandUsersList.innerHTML = '<div class="empty-state"><i class="fas fa-user-slash"></i><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø¢Ø®Ø±ÙˆÙ†</p></div>';
                return;
            }
            
            let usersHTML = '';
            const users = usersSnapshot.val();
            
            Object.entries(users).forEach(([userId, user]) => {
                if (userId === currentUser.uid) return;
                
                usersHTML += `
                    <div class="command-user-item" data-user-id="${userId}">
                        <img src="${user.photoURL || 'https://ui-avatars.com/api/?name=Ù…Ø³ØªØ®Ø¯Ù…&background=5865F2&color=fff'}" 
                             class="command-user-avatar" 
                             alt="${user.name}"
                             onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=5865F2&color=fff'">
                        <div class="command-user-info">
                            <div class="command-user-name">${user.name} (${user.shortId})</div>
                            <div class="command-user-email">${user.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯'}</div>
                        </div>
                        ${user.isAdmin ? '<span style="color: var(--error);"><i class="fas fa-crown"></i></span>' : ''}
                    </div>
                `;
            });
            
            commandUsersList.innerHTML = usersHTML;
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            document.querySelectorAll('.command-user-item').forEach(item => {
                item.addEventListener('click', () => {
                    const userId = item.dataset.userId;
                    const userName = users[userId].name;
                    const userShortId = users[userId].shortId;
                    executeCommand(command, userId, userName, userShortId);
                });
            });
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:', error);
            commandUsersList.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-circle"></i><p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p></div>';
        }
    }

    // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    commandCancelBtn.addEventListener('click', () => {
        commandModal.style.display = 'none';
    });

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    commandModal.addEventListener('click', (e) => {
        if (e.target === commandModal) {
            commandModal.style.display = 'none';
        }
    });

    // ØªÙ†ÙÙŠØ° Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    async function executeCommand(command, targetUserId, targetUserName, targetShortId) {
        commandModal.style.display = 'none';
        
        try {
            switch(command) {
                case 'lock':
                    const reason = prompt('Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ù‚ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):') || 'Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…Ù‚ÙÙˆÙ„Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ù…Ù†';
                    
                    await update(chatSettingsRef, {
                        isLocked: true,
                        lockedBy: currentUser.shortId,
                        lockReason: reason,
                        lockedAt: serverTimestamp()
                    });
                    
                    await push(messagesRef, {
                        type: 'system',
                        userId: 'system',
                        userName: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                        userAvatar: 'https://cdn-icons-png.flaticon.com/512/1828/1828640.png',
                        text: `ğŸ”’ Ù‚Ø§Ù… ${currentUser.name} Ø¨Ù‚ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©: ${reason}`,
                        timestamp: serverTimestamp()
                    });
                    
                    showNotification('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    break;
                    
                case 'mute':
                    const duration = prompt('Ø£Ø¯Ø¯Ø¯ Ù…Ø¯Ø© Ø§Ù„ÙƒØªÙ… Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚:', '60');
                    const muteDuration = parseInt(duration) || 60;
                    const muteReason = prompt('Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø§Ù„ÙƒØªÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):') || 'ØªÙ… Ø§Ù„ÙƒØªÙ… Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ù…Ù†';
                    
                    const muteUntil = new Date();
                    muteUntil.setMinutes(muteUntil.getMinutes() + muteDuration);
                    
                    await set(ref(db, `mutedUsers/${targetUserId}`), {
                        mutedBy: currentUser.shortId,
                        mutedUntil: muteUntil.toISOString(),
                        reason: muteReason,
                        mutedAt: serverTimestamp(),
                        userName: targetUserName,
                        shortId: targetShortId
                    });
                    
                    await push(messagesRef, {
                        type: 'system',
                        userId: 'system',
                        userName: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                        userAvatar: 'https://cdn-icons-png.flaticon.com/512/1828/1828640.png',
                        text: `ğŸ¤« Ù‚Ø§Ù… ${currentUser.name} Ø¨ÙƒØªÙ… ${targetUserName} Ù„Ù…Ø¯Ø© ${muteDuration} Ø¯Ù‚ÙŠÙ‚Ø©: ${muteReason}`,
                        timestamp: serverTimestamp()
                    });
                    
                    showNotification('Ù†Ø¬Ø§Ø­', `ØªÙ… ÙƒØªÙ… ${targetUserName} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    break;
                    
                case 'unmute':
                    await remove(ref(db, `mutedUsers/${targetUserId}`));
                    
                    await push(messagesRef, {
                        type: 'system',
                        userId: 'system',
                        userName: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                        userAvatar: 'https://cdn-icons-png.flaticon.com/512/1828/1828640.png',
                        text: `ğŸ¤ Ù‚Ø§Ù… ${currentUser.name} Ø¨Ø¥Ø²Ø§Ù„Ø© ÙƒØªÙ… ${targetUserName}`,
                        timestamp: serverTimestamp()
                    });
                    
                    showNotification('Ù†Ø¬Ø§Ø­', `ØªÙ… Ø¥Ø²Ø§Ù„Ø© ÙƒØªÙ… ${targetUserName} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    break;
                    
                case 'role':
                    await update(ref(db, `users/${targetUserId}`), {
                        isAdmin: true
                    });
                    
                    await push(messagesRef, {
                        type: 'system',
                        userId: 'system',
                        userName: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                        userAvatar: 'https://cdn-icons-png.flaticon.com/512/1828/1828640.png',
                        text: `ğŸ‘‘ Ù‚Ø§Ù… ${currentUser.name} Ø¨ØªØ±Ù‚ÙŠØ© ${targetUserName} Ø¥Ù„Ù‰ Ø¥Ø¯Ù…Ù†`,
                        timestamp: serverTimestamp()
                    });
                    
                    showNotification('Ù†Ø¬Ø§Ø­', `ØªÙ… ØªØ±Ù‚ÙŠØ© ${targetUserName} Ø¥Ù„Ù‰ Ø¥Ø¯Ù…Ù†`, 'success');
                    break;
                    
                case 'unrole':
                    await update(ref(db, `users/${targetUserId}`), {
                        isAdmin: false
                    });
                    
                    await push(messagesRef, {
                        type: 'system',
                        userId: 'system',
                        userName: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                        userAvatar: 'https://cdn-icons-png.flaticon.com/512/1828/1828640.png',
                        text: `ğŸ‘¤ Ù‚Ø§Ù… ${currentUser.name} Ø¨Ø¥Ø²Ø§Ù„Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù† Ù…Ù† ${targetUserName}`,
                        timestamp: serverTimestamp()
                    });
                    
                    showNotification('Ù†Ø¬Ø§Ø­', `ØªÙ… Ø¥Ø²Ø§Ù„Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù† Ù…Ù† ${targetUserName}`, 'success');
                    break;
            }
            
        } catch (error) {
            console.error(`Ø®Ø·Ø£ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø± ${command}:`, error);
            showNotification('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø±', 'error');
        }
    }

    // ========== ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø© ==========

    // Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© (ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† Ø²Ø± Ø§Ù„Ø­Ø°Ù ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„)
    window.deleteMessage = async function(messageId) {
        if (!currentUser.isAdmin) {
            showNotification('Ø±ÙØ¶', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†', 'error');
            return;
        }
        
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) {
            try {
                await remove(ref(db, `messages/${messageId}`));
                showNotification('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'success');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
                showNotification('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
            }
        }
    };

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    window.addEventListener('online', () => {
        onlineStatus.textContent = 'Ù…ØªØµÙ„';
        serverStatus.textContent = 'âœ“ Ù†Ø´Ø·';
        serverStatus.style.color = 'var(--success)';
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ…ØªØµÙ„
        if (currentUser.uid) {
            update(ref(db, `users/${currentUser.uid}`), {
                online: true,
                lastSeen: serverTimestamp()
            });
        }
    });
    
    window.addEventListener('offline', () => {
        onlineStatus.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
        serverStatus.textContent = 'âœ— ØºÙŠØ± Ù†Ø´Ø·';
        serverStatus.style.color = 'var(--error)';
    });

    // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('beforeunload', async () => {
        if (currentUser.uid) {
            await remove(ref(db, `onlineUsers/${currentUser.uid}`));
            await update(ref(db, `users/${currentUser.uid}`), {
                online: false,
                lastSeen: serverTimestamp()
            });
        }
    });

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    console.log('ğŸš€ ØªØ·Ø¨ÙŠÙ‚ Discond Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„!');

</script>

</body>
</html>
